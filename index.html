<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Link Sender App</title>
  <link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#000000">

<!-- iOS "Add to Home Screen" support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Link Assistant">
<link rel="apple-touch-icon" href="./Icon/icon-192.png">
  <style>
    body{font-family:Arial,sans-serif;text-align:center;background:#000;color:#adadae;margin:20px;}
    .wrap{max-width:920px;margin:0 auto;}

    /* Logo */
    .logo-container{margin-bottom:14px;display:flex;justify-content:center;}
    .logo-box{
      width:min(380px, 92vw);
      height:110px;
      border:2px dashed rgba(173,173,174,.55);
      border-radius:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#c7c7c7;
      background:rgba(255,255,255,.03);
      overflow:hidden;
      position:relative;
      cursor:pointer;
      user-select:none;
    }
    .logo-box:hover{
      background:rgba(255,255,255,.055);
      border-color:rgba(173,173,174,.8);
    }
    .logo-box:active{ transform:translateY(1px); }
    .logo-box img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;
      display:none; /* hidden until a logo is loaded */
      pointer-events:none;
    }
    .logo-placeholder{
      padding:10px 14px;
      font-size:16px;
      letter-spacing:.2px;
      pointer-events:none;
    }
    .logo-hint{
      position:absolute;
      bottom:8px;
      left:0; right:0;
      font-size:12px;
      color:rgba(199,199,199,.85);
      pointer-events:none;
    }
    #logoUpload{display:none;}

    input,button,textarea{font-size:16px;padding:12px;border:none;border-radius:8px;box-sizing:border-box;}
    input,textarea{background:#3c3c44;color:#fff;width:100%;}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;margin:10px 0;}
    .row .grow{flex:1 1 260px;min-width:240px;}
    .row .fixed{flex:0 0 auto;}

    .panel{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px;
      padding:14px;
      margin:14px auto 18px;
      text-align:left;
    }
    .panel h3{margin:0 0 10px;font-size:16px;color:#d7d7d7;letter-spacing:.3px;}
    .panel .help{font-size:12px;color:#c7c7c7;margin-top:6px;}
    .label{font-size:13px;color:#c7c7c7;margin:0 0 6px;}

    .send-button{
      display:block;margin:10px auto;padding:12px;font-size:18px;cursor:pointer;
      background:linear-gradient(45deg,#3c3c44,#656565);color:silver;border:none;border-radius:8px;
      width:100%;max-width:520px;transition:all .2s;box-shadow:0 0 8px rgba(0,123,255,.5);
      text-align:center;white-space:normal;line-height:1.2;
    }
    .send-button:active{box-shadow:0 0 15px rgba(0,123,255,1);}
    .send-button.selected{
      outline:2px solid rgba(0,123,255,.9);
      box-shadow:0 0 18px rgba(0,123,255,.95);
      transform:translateY(-1px);
    }

    .action-button{
      cursor:pointer;
      background:linear-gradient(45deg,#1f1f25,#3a3a44);
      color:#fff;border:none;border-radius:8px;
      transition:all .2s;
      box-shadow:0 0 8px rgba(40,167,69,.35);
      width:100%;
    }
    .action-button:active{box-shadow:0 0 15px rgba(40,167,69,.85);}
    .action-button.secondary{
      background:linear-gradient(45deg,#2b2b33,#40404a);
      box-shadow:0 0 8px rgba(255,255,255,.08);
      color:#d7d7d7;
    }
    .action-button.danger{
      background:linear-gradient(45deg,#2a1d1d,#4a2b2b);
      box-shadow:0 0 8px rgba(220,53,69,.25);
      color:#ffd7d7;
    }
    .action-button.info{
      background:linear-gradient(45deg,#162026,#233844);
      box-shadow:0 0 8px rgba(0,123,255,.25);
      color:#d7ecff;
    }

    .count{margin-top:6px;font-size:14px;color:#c7c7c7;}
    .button-container{margin-top:18px;display:flex;flex-direction:column;align-items:center;}

    /* Bigger color picker */
    .color-wrap{display:flex;gap:10px;align-items:center;width:100%;}
    .color-wrap input[type="color"]{
      width:84px;height:60px;padding:0;background:transparent;
      border:2px solid rgba(255,255,255,.22);
      border-radius:14px;cursor:pointer;box-sizing:border-box;
    }
    .color-wrap input[type="color"]:hover{ border-color: rgba(255,255,255,.45); }
    .color-wrap input[type="color"]:active{ transform: scale(0.98); }

    .status{font-size:12px;color:#c7c7c7;margin-top:6px;}
    .divider{height:1px;background:rgba(255,255,255,.08);margin:12px 0;}
    .smallnote{font-size:12px;color:#c7c7c7;margin-top:6px;}
  </style>
</head>

<body>
  <div class="wrap">
    <!-- CLICKABLE LOGO AREA -->
    <div class="logo-container">
      <div class="logo-box" id="logoBox" title="Click to upload a logo">
        <div class="logo-placeholder" id="logoPlaceholder">Insert logo here</div>
        <img id="logoImg" alt="Uploaded Logo" />
        <div class="logo-hint" id="logoHint">Click to upload</div>
      </div>
    </div>

    <input type="file" id="logoUpload" accept="image/*" />

    <h2>Link Assistant</h2>

    <div class="panel">
      <h3>Customize</h3>

      <div class="row">
        <div class="grow">
          <div class="label">Background Color (saved when you click Save)</div>
          <div class="color-wrap">
            <input type="color" id="bgColorPicker" value="#000000" />
            <input type="text" id="bgColorText" placeholder="#000000" value="#000000" />
            <button class="action-button secondary" type="button" onclick="resetBg()">Reset</button>
          </div>
          <div class="help">Tip: Click Save to keep your color after refresh.</div>
        </div>
      </div>

      <div class="divider"></div>

      <h3>Add Items (Start from none)</h3>
      <div class="smallnote">
        One item = one button. Enter a Title + a Value. If Value starts with http(s), it sends as a link; otherwise it sends as text.
      </div>

      <!-- ✅ SINGLE ADD ITEM (Title + Link OR Text) -->
      <div class="row">
        <div class="grow">
          <div class="label">Button Title</div>
          <input type="text" id="itemTitle" placeholder="Example: Payment Link" />
        </div>
        <div class="grow">
          <div class="label">Link or Text</div>
          <input type="text" id="itemValue" placeholder="https://...  OR  paste text here" />
        </div>
        <div class="fixed" style="min-width:180px;width:180px;">
          <div class="label">&nbsp;</div>
          <button class="action-button" type="button" onclick="addItem()">Add Item</button>
        </div>
      </div>

      <div class="row">
        <div class="fixed" style="min-width:220px;width:220px;">
          <button class="action-button danger" type="button" onclick="removeSelectedItems()">Remove Selected</button>
        </div>

        <div class="fixed" style="min-width:180px;width:180px;">
          <button class="action-button info" type="button" onclick="saveAll()">Save</button>
        </div>

        <div class="fixed" style="min-width:220px;width:220px;">
          <button class="action-button secondary" type="button" onclick="resetSaved()">Reset Saved</button>
        </div>
      </div>

      <div class="status" id="saveStatus">Starting from none. Add items/logo/color and click Save to keep after refresh.</div>
    </div>

    <!-- RECIPIENT + ACTION BAR -->
    <div class="row">
      <div class="grow">
        <input type="text" id="recipient" placeholder="Enter email or phone number">
      </div>
      <div class="fixed" style="min-width:180px;width:180px;">
        <button class="action-button" onclick="sendSelected()">Send Selected</button>
      </div>
      <div class="fixed" style="min-width:180px;width:180px;">
        <button class="action-button secondary" onclick="clearSelection()">Clear Selection</button>
      </div>
    </div>

    <div class="count" id="selectedCount">Selected: 0</div>
    <div class="button-container" id="buttonContainer"></div>
  </div>

  <script>
    const LS_KEYS = {
      bg: "linkAssistant_bgColor",
      customItems: "linkAssistant_customItems",
      logo: "linkAssistant_logoDataUrl"
    };

    function getCustomItems(){
      try { return JSON.parse(localStorage.getItem(LS_KEYS.customItems) || "[]"); }
      catch { return []; }
    }
    function setCustomItems(items){
      localStorage.setItem(LS_KEYS.customItems, JSON.stringify(items));
    }
    function makeId(){
      return "i_" + Math.random().toString(36).slice(2) + Date.now().toString(36);
    }

    let draftBg = "#000000";
    let draftCustomItems = [];
    let draftLogoDataUrl = "";

    function setStatus(msg){
      document.getElementById("saveStatus").textContent = msg;
    }

    // Logo box triggers upload
    const logoBox = document.getElementById("logoBox");
    const logoUpload = document.getElementById("logoUpload");
    logoBox.addEventListener("click", () => logoUpload.click());
    logoBox.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") logoUpload.click();
    });
    logoBox.setAttribute("tabindex","0");

    function showLogo(dataUrl){
      const img = document.getElementById("logoImg");
      const ph = document.getElementById("logoPlaceholder");
      const hint = document.getElementById("logoHint");

      if (dataUrl && dataUrl.startsWith("data:image/")){
        img.src = dataUrl;
        img.style.display = "block";
        ph.style.display = "none";
        hint.textContent = "Click to change";
      } else {
        img.removeAttribute("src");
        img.style.display = "none";
        ph.style.display = "block";
        hint.textContent = "Click to upload";
      }
    }

    function updateCount(){
      const selected = document.querySelectorAll(".send-button.selected").length;
      document.getElementById("selectedCount").textContent = `Selected: ${selected}`;
    }

    function toggleSelect(button){
      button.classList.toggle("selected");
      updateCount();
    }

    function clearSelection(){
      document.querySelectorAll(".send-button.selected").forEach(btn => btn.classList.remove("selected"));
      updateCount();
    }

    function buildCombinedMessage(){
      const selectedButtons = Array.from(document.querySelectorAll(".send-button.selected"));
      if (selectedButtons.length === 0) return null;

      const lines = ["Here are the requested links/info:", ""];

      selectedButtons.forEach((btn) => {
        const title = btn.getAttribute("data-title") || "Item";
        const link = btn.getAttribute("data-link") || "";
        const customBody = btn.getAttribute("data-body");

        lines.push(`— ${title}`);

        // Text-only item
        if ((!link || link.trim() === "") && customBody && customBody.trim().length > 0) {
          lines.push(customBody.trim(), "");
          return;
        }

        // Link item (optionally with body)
        if (customBody && customBody.trim().length > 0) {
          lines.push(customBody.trim(), "");
          if (link && link.trim().length > 0) lines.push(`Link: ${link}`);
        } else {
          if (link && link.trim().length > 0) lines.push(link);
        }

        lines.push("");
      });

      return { subject: `Links (${selectedButtons.length})`, body: lines.join("\n") };
    }

    function sendSelected(){
      const recipient = document.getElementById("recipient").value.trim();
      if (!recipient) return alert("Please enter an email or phone number.");

      const payload = buildCombinedMessage();
      if (!payload) return alert("Select at least one item first.");

      if (recipient.includes("@")){
        window.open(`mailto:${recipient}?subject=${encodeURIComponent(payload.subject)}&body=${encodeURIComponent(payload.body)}`);
      } else {
        window.open(`sms:${recipient}?body=${encodeURIComponent(payload.body)}`);
      }
    }

    // Logo upload handler (draft until Save)
    logoUpload.addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      if (!file.type.startsWith("image/")){
        alert("Please upload an image file.");
        e.target.value = "";
        return;
      }

      if (file.size > 2_000_000) {
        const ok = confirm("This logo file is a bit large. It may not save in some browsers. Continue?");
        if (!ok) { e.target.value = ""; return; }
      }

      const reader = new FileReader();
      reader.onload = () => {
        draftLogoDataUrl = reader.result;
        showLogo(draftLogoDataUrl);
        setStatus("Unsaved changes.");
      };
      reader.readAsDataURL(file);
    });

    // Background color (draft until Save)
    const bgPicker = document.getElementById("bgColorPicker");
    const bgText = document.getElementById("bgColorText");
    function isValidHexColor(v){ return /^#([0-9A-Fa-f]{6})$/.test(v.trim()); }

    function applyBgColor(hex){
      document.body.style.backgroundColor = hex;
      bgPicker.value = hex;
      bgText.value = hex;
      draftBg = hex;
      setStatus("Unsaved changes.");
    }
    bgPicker.addEventListener("input", () => applyBgColor(bgPicker.value));
    bgText.addEventListener("input", () => {
      const v = bgText.value.trim();
      if (isValidHexColor(v)) applyBgColor(v);
    });
    function resetBg(){ applyBgColor("#000000"); }

    // Items
    function renderItem(item){
      const btn = document.createElement("button");
      btn.className = "send-button";
      btn.textContent = item.title || (item.type === "text" ? "Custom Text" : "Custom Link");

      btn.setAttribute("data-custom-id", item.id);
      btn.setAttribute("data-title", item.title || "");

      if (item.type === "link") btn.setAttribute("data-link", item.link || "");
      if (item.type === "text") btn.setAttribute("data-body", item.body || "");

      btn.addEventListener("click", () => toggleSelect(btn));
      document.getElementById("buttonContainer").appendChild(btn);
    }

    function loadAndRenderSavedItems(){
      const saved = getCustomItems();
      saved.forEach(renderItem);
      draftCustomItems = saved.slice();
    }

    // ✅ SINGLE addItem(): decides link vs text based on value
    function addItem(){
      const title = document.getElementById("itemTitle").value.trim();
      const value = document.getElementById("itemValue").value.trim();

      if (!title) return alert("Please enter a button title.");
      if (!value) return alert("Please enter a link or text.");

      const isLink = /^https?:\/\/\S+/i.test(value);

      const item = isLink
        ? { id: makeId(), type: "link", title, link: value }
        : { id: makeId(), type: "text", title, body: value };

      draftCustomItems.push(item);
      renderItem(item);

      document.getElementById("itemTitle").value = "";
      document.getElementById("itemValue").value = "";
      setStatus("Unsaved changes.");
    }

    function removeSelectedItems(){
      const selected = Array.from(document.querySelectorAll(".send-button.selected"));
      if (selected.length === 0) return alert("Select at least one item to remove.");

      const idsToRemove = selected.map(btn => btn.getAttribute("data-custom-id")).filter(Boolean);
      selected.forEach(btn => btn.remove());

      if (idsToRemove.length){
        draftCustomItems = draftCustomItems.filter(x => !idsToRemove.includes(x.id));
        setStatus("Unsaved changes.");
      }
      updateCount();
    }

    // Save / Reset
    function saveAll(){
      try {
        localStorage.setItem(LS_KEYS.bg, draftBg);
        setCustomItems(draftCustomItems);

        if (draftLogoDataUrl && draftLogoDataUrl.startsWith("data:image/")) {
          localStorage.setItem(LS_KEYS.logo, draftLogoDataUrl);
        } else {
          localStorage.removeItem(LS_KEYS.logo);
        }

        setStatus("Saved. Refreshing will keep your background + items + logo (if added).");
      } catch (e) {
        alert("Could not save. The logo may be too large for browser storage. Try a smaller image (PNG/JPG under ~1–2MB).");
        console.error(e);
      }
    }

    function resetSaved(){
      localStorage.removeItem(LS_KEYS.bg);
      localStorage.removeItem(LS_KEYS.customItems);
      localStorage.removeItem(LS_KEYS.logo);

      draftBg = "#000000";
      draftCustomItems = [];
      draftLogoDataUrl = "";

      applyBgColor("#000000");
      document.getElementById("buttonContainer").innerHTML = "";
      clearSelection();
      showLogo("");

      setStatus("Saved data cleared. Starting from none again.");
    }

    // Init
    (function init(){
      showLogo("");

      const savedBg = localStorage.getItem(LS_KEYS.bg);
      if (savedBg && isValidHexColor(savedBg)){
        document.body.style.backgroundColor = savedBg;
        bgPicker.value = savedBg;
        bgText.value = savedBg;
        draftBg = savedBg;
      } else {
        document.body.style.backgroundColor = "#000000";
        bgPicker.value = "#000000";
        bgText.value = "#000000";
        draftBg = "#000000";
      }

      const savedLogo = localStorage.getItem(LS_KEYS.logo);
      if (savedLogo && savedLogo.startsWith("data:image/")){
        draftLogoDataUrl = savedLogo;
        showLogo(savedLogo);
      }

      loadAndRenderSavedItems();
      updateCount();

      const hasSavedAnything =
        (savedBg && isValidHexColor(savedBg)) ||
        (getCustomItems().length > 0) ||
        (savedLogo && savedLogo.startsWith("data:image/"));

      setStatus(hasSavedAnything
        ? "Loaded saved settings (if any). Click Save after changes."
        : "Starting from none. Click the logo box to upload a logo, then click Save."
      );
    })();
  // PWA Service Worker
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js");
  });
}
  </script>
</body>
</html>
